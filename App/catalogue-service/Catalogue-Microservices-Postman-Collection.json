{
	"info": {
		"_postman_id": "catalogue-microservices-2024-updated",
		"name": "Catalogue Microservices - Complete API Tests (Updated)",
		"description": "Collection complète de tests pour les microservices du catalogue\n\n**Architecture:**\n- Config Server (8888)\n- Eureka Server (8761)\n- API Gateway (8080)\n- User Service (8083)\n- Product Service (8081)\n- Order Service (8085)\n- Payment Service (8084)\n\n**Important:** Tous les appels passent par l'API Gateway (port 8080)\n\n**Nouveautés:**\n- User Service avec gestion des rôles (CLIENT/ADMIN)\n- Payment Service avec intégration PayPal\n- Order Service refactorisé (userId au lieu des détails client)\n- Product Service avec catégories intégrées",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Infrastructure Services",
			"item": [
				{
					"name": "Config Server - Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8888/actuator/health",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8888",
							"path": ["actuator", "health"]
						}
					}
				},
				{
					"name": "Eureka Server - Dashboard",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8761/",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8761",
							"path": [""]
						}
					}
				},
				{
					"name": "API Gateway - Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/actuator/health",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["actuator", "health"]
						}
					}
				}
			]
		},
		{
			"name": "2. User Service (via Gateway)",
			"item": [
				{
					"name": "GET All Users",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users"]
						},
						"description": "Récupère tous les utilisateurs"
					}
				},
				{
					"name": "GET User by ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "1"]
						},
						"description": "Récupère un utilisateur par son ID"
					}
				},
				{
					"name": "GET User by Email",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/email/john.doe@example.com",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "email", "john.doe@example.com"]
						},
						"description": "Récupère un utilisateur par son email"
					}
				},
				{
					"name": "POST Create User - Client",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"client@example.com\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"password\": \"password123\",\n  \"phoneNumber\": \"+33612345678\",\n  \"address\": \"123 Rue de la Paix, Paris\",\n  \"role\": \"CLIENT\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/users",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users"]
						},
						"description": "Crée un nouvel utilisateur CLIENT"
					}
				},
				{
					"name": "POST Create User - Admin",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@example.com\",\n  \"firstName\": \"Admin\",\n  \"lastName\": \"System\",\n  \"password\": \"admin123\",\n  \"phoneNumber\": \"+33612345679\",\n  \"address\": \"456 Avenue des Champs, Paris\",\n  \"role\": \"ADMIN\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/users",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users"]
						},
						"description": "Crée un nouvel utilisateur ADMIN"
					}
				},
				{
					"name": "PUT Update User",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.updated@example.com\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Smith\",\n  \"password\": \"newpassword123\",\n  \"phoneNumber\": \"+33687654321\",\n  \"address\": \"789 Boulevard Saint-Germain, Paris\",\n  \"role\": \"CLIENT\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/users/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "1"]
						},
						"description": "Met à jour un utilisateur existant"
					}
				},
				{
					"name": "GET Users by Role - CLIENT",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/role/CLIENT",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "role", "CLIENT"]
						},
						"description": "Récupère tous les utilisateurs avec le rôle CLIENT"
					}
				},
				{
					"name": "GET Users by Role - ADMIN",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/role/ADMIN",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "role", "ADMIN"]
						},
						"description": "Récupère tous les utilisateurs avec le rôle ADMIN"
					}
				},
				{
					"name": "GET Active Users",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/active",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "active"]
						},
						"description": "Récupère uniquement les utilisateurs actifs"
					}
				},
				{
					"name": "PATCH Deactivate User",
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/1/deactivate",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "1", "deactivate"]
						},
						"description": "Désactive un utilisateur"
					}
				},
				{
					"name": "PATCH Activate User",
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/1/activate",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "1", "activate"]
						},
						"description": "Active un utilisateur"
					}
				},
				{
					"name": "GET User Orders (OpenFeign)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/1/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "1", "orders"]
						},
						"description": "⭐ OPENFEIGN: User Service appelle Order Service pour récupérer les commandes de l'utilisateur"
					}
				},
				{
					"name": "DELETE User",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/99",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "99"]
						},
						"description": "Supprime un utilisateur"
					}
				}
			]
		},
		{
			"name": "3. Product Service (via Gateway)",
			"item": [
				{
					"name": "GET All Products",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products"]
						},
						"description": "Récupère tous les produits"
					}
				},
				{
					"name": "GET Product by ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "1"]
						},
						"description": "Récupère un produit par son ID"
					}
				},
				{
					"name": "POST Create Product",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nom\": \"Laptop Gaming ROG\",\n  \"description\": \"Ordinateur portable haute performance pour gaming\",\n  \"prix\": 1599.99,\n  \"stockQuantity\": 25,\n  \"disponible\": true,\n  \"categoryName\": \"Electronics\",\n  \"categoryDescription\": \"Electronic devices and gadgets\",\n  \"imageUrl\": \"https://example.com/laptop.jpg\"\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/products",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products"]
						},
						"description": "Crée un nouveau produit avec catégorie intégrée"
					}
				},
				{
					"name": "PUT Update Product",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"nom\": \"Laptop Gaming ROG Updated\",\n  \"description\": \"Ordinateur portable haute performance - Nouvelle génération\",\n  \"prix\": 1799.99,\n  \"stockQuantity\": 30,\n  \"disponible\": true,\n  \"categoryName\": \"Electronics\",\n  \"categoryDescription\": \"Electronic devices and gadgets\",\n  \"imageUrl\": \"https://example.com/laptop-updated.jpg\"\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/products/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "1"]
						},
						"description": "Met à jour un produit existant"
					}
				},
				{
					"name": "GET Products by Category",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/category/Electronics",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "category", "Electronics"]
						},
						"description": "Récupère tous les produits d'une catégorie"
					}
				},
				{
					"name": "GET Available Products",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/available",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "available"]
						},
						"description": "Récupère uniquement les produits disponibles"
					}
				},
				{
					"name": "GET Search Products",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/search?keyword=laptop",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "search"],
							"query": [
								{
									"key": "keyword",
									"value": "laptop"
								}
							]
						},
						"description": "Recherche des produits par mot-clé"
					}
				},
				{
					"name": "PATCH Update Stock",
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/1/stock?quantity=-5",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "1", "stock"],
							"query": [
								{
									"key": "quantity",
									"value": "-5",
									"description": "Négatif pour retirer, positif pour ajouter"
								}
							]
						},
						"description": "Met à jour le stock d'un produit"
					}
				},
				{
					"name": "DELETE Product",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/99",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "99"]
						},
						"description": "Supprime un produit"
					}
				}
			]
		},
		{
			"name": "4. Order Service (via Gateway)",
			"item": [
				{
					"name": "GET All Orders",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders"]
						},
						"description": "Récupère toutes les commandes"
					}
				},
				{
					"name": "GET Order by ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders", "1"]
						},
						"description": "Récupère une commande par son ID"
					}
				},
				{
					"name": "GET Order by Order Number",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders/order-number/ORD-1234567890-ABCD1234",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders", "order-number", "ORD-1234567890-ABCD1234"]
						},
						"description": "Récupère une commande par son numéro"
					}
				},
				{
					"name": "POST Create Order (OpenFeign)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userId\": 1,\n  \"adresseLivraison\": \"123 Rue de la Paix, 75001 Paris, France\",\n  \"orderItems\": [\n    {\n      \"productId\": 1,\n      \"quantity\": 2\n    },\n    {\n      \"productId\": 2,\n      \"quantity\": 1\n    }\n  ]\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders"]
						},
						"description": "⭐ OPENFEIGN: Order Service appelle Product Service pour:\n1. Vérifier la disponibilité\n2. Récupérer les prix\n3. Mettre à jour le stock\n4. Calculer le montant total"
					}
				},
				{
					"name": "POST Create Order - Check Stock Update",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.sendRequest('http://localhost:8080/api/products/1', function (err, response) {",
									"    const product = response.json();",
									"    pm.environment.set('stockBefore', product.stockQuantity);",
									"    console.log('Stock avant commande:', product.stockQuantity);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"setTimeout(function() {",
									"    pm.sendRequest('http://localhost:8080/api/products/1', function (err, response) {",
									"        const product = response.json();",
									"        const stockBefore = pm.environment.get('stockBefore');",
									"        console.log('Stock après commande:', product.stockQuantity);",
									"        console.log('Différence:', stockBefore - product.stockQuantity);",
									"    });",
									"}, 1000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userId\": 1,\n  \"adresseLivraison\": \"456 Avenue des Champs-Élysées, Paris\",\n  \"orderItems\": [\n    {\n      \"productId\": 1,\n      \"quantity\": 3\n    }\n  ]\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders"]
						},
						"description": "⭐ DÉMONSTRATION OPENFEIGN:\n1. Le stock est vérifié avant\n2. La commande est créée\n3. Le stock diminue automatiquement"
					}
				},
				{
					"name": "GET Orders by User",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders/user/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders", "user", "1"]
						},
						"description": "Récupère toutes les commandes d'un utilisateur"
					}
				},
				{
					"name": "GET Orders by Status",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders/status/PENDING",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders", "status", "PENDING"]
						},
						"description": "Récupère toutes les commandes avec un statut spécifique\nStatuts: PENDING, CONFIRMED, SHIPPED, DELIVERED, CANCELLED"
					}
				},
				{
					"name": "GET Orders by Date Range",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders/date-range?start=2024-01-01T00:00:00Z&end=2024-12-31T23:59:59Z",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders", "date-range"],
							"query": [
								{
									"key": "start",
									"value": "2024-01-01T00:00:00Z"
								},
								{
									"key": "end",
									"value": "2024-12-31T23:59:59Z"
								}
							]
						},
						"description": "Récupère les commandes dans une plage de dates"
					}
				},
				{
					"name": "PATCH Update Order Status",
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders/1/status?status=CONFIRMED",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders", "1", "status"],
							"query": [
								{
									"key": "status",
									"value": "CONFIRMED"
								}
							]
						},
						"description": "Met à jour le statut d'une commande"
					}
				},
				{
					"name": "PATCH Cancel Order",
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders/1/cancel",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders", "1", "cancel"]
						},
						"description": "Annule une commande et restaure le stock"
					}
				},
				{
					"name": "DELETE Order",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/orders/99",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders", "99"]
						},
						"description": "Supprime une commande"
					}
				}
			]
		},
		{
			"name": "5. Payment Service (via Gateway)",
			"item": [
				{
					"name": "GET All Payments",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/payments",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments"]
						},
						"description": "Récupère tous les paiements"
					}
				},
				{
					"name": "GET Payment by ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/payments/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "1"]
						},
						"description": "Récupère un paiement par son ID"
					}
				},
				{
					"name": "GET Payments by Order",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/payments/order/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "order", "1"]
						},
						"description": "Récupère tous les paiements d'une commande"
					}
				},
				{
					"name": "GET Payments by User",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/payments/user/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "user", "1"]
						},
						"description": "Récupère tous les paiements d'un utilisateur"
					}
				},
				{
					"name": "GET Payments by Status",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/payments/status/COMPLETED",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "status", "COMPLETED"]
						},
						"description": "Récupère les paiements par statut\nStatuts: PENDING, COMPLETED, FAILED, CANCELLED, REFUNDED"
					}
				},
				{
					"name": "POST Create PayPal Payment",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"orderId\": 1,\n  \"userId\": 1,\n  \"amount\": 299.99,\n  \"currency\": \"USD\",\n  \"description\": \"Payment for Order #ORD-1234567890-ABCD1234\",\n  \"cancelUrl\": \"http://localhost:3000/payment/cancel\",\n  \"successUrl\": \"http://localhost:3000/payment/success\"\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/payments/paypal/create",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "paypal", "create"]
						},
						"description": "⭐ PAYPAL: Crée un paiement PayPal\nRenvoie:\n- paymentId: ID du paiement PayPal\n- approvalUrl: URL pour rediriger l'utilisateur\n- status: created"
					}
				},
				{
					"name": "POST Execute PayPal Payment",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"paymentId\": \"PAYID-XXXXXXXXXXXXXXX\",\n  \"payerId\": \"PAYERID123456789\"\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/payments/paypal/execute",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "paypal", "execute"]
						},
						"description": "⭐ PAYPAL: Exécute le paiement après approbation de l'utilisateur\nÀ appeler après que l'utilisateur revient de PayPal"
					}
				},
				{
					"name": "POST Cancel PayPal Payment",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/payments/paypal/cancel/PAYID-XXXXXXXXXXXXXXX",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "paypal", "cancel", "PAYID-XXXXXXXXXXXXXXX"]
						},
						"description": "⭐ PAYPAL: Annule un paiement PayPal"
					}
				}
			]
		},
		{
			"name": "6. DEMO Complete Flow - Order + Payment",
			"item": [
				{
					"name": "STEP 1: Create User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"pm.environment.set('userId', response.id);",
									"console.log('User created with ID:', response.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"demo.user@example.com\",\n  \"firstName\": \"Demo\",\n  \"lastName\": \"User\",\n  \"password\": \"demo123\",\n  \"phoneNumber\": \"+33612345678\",\n  \"address\": \"123 Demo Street, Paris\",\n  \"role\": \"CLIENT\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/users",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users"]
						},
						"description": "Étape 1: Créer un utilisateur et sauvegarder l'ID"
					}
				},
				{
					"name": "STEP 2: Check Product Stock",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const product = pm.response.json();",
									"pm.environment.set('productId', product.id);",
									"pm.environment.set('stockBefore', product.stockQuantity);",
									"pm.environment.set('productPrice', product.prix);",
									"console.log('Product ID:', product.id);",
									"console.log('Stock avant:', product.stockQuantity);",
									"console.log('Prix:', product.prix);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "1"]
						},
						"description": "Étape 2: Vérifier le stock du produit"
					}
				},
				{
					"name": "STEP 3: Create Order (OpenFeign)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const order = pm.response.json();",
									"pm.environment.set('orderId', order.id);",
									"pm.environment.set('orderNumber', order.orderNumber);",
									"pm.environment.set('orderTotal', order.montantTotal);",
									"console.log('Order created:');",
									"console.log('- Order ID:', order.id);",
									"console.log('- Order Number:', order.orderNumber);",
									"console.log('- Total:', order.montantTotal);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userId\": {{userId}},\n  \"adresseLivraison\": \"123 Demo Street, Paris, France\",\n  \"orderItems\": [\n    {\n      \"productId\": {{productId}},\n      \"quantity\": 2\n    }\n  ]\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders"]
						},
						"description": "⭐ Étape 3: Créer une commande\nOrder Service → Product Service (OpenFeign)\n- Vérifie disponibilité\n- Met à jour le stock\n- Calcule le total"
					}
				},
				{
					"name": "STEP 4: Verify Stock Decreased",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "1"]
						},
						"description": "Étape 4: Vérifier que le stock a diminué\nComparer avec stockBefore"
					}
				},
				{
					"name": "STEP 5: Create PayPal Payment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const response = pm.response.json();",
									"pm.environment.set('paymentId', response.paymentId);",
									"pm.environment.set('approvalUrl', response.approvalUrl);",
									"console.log('Payment created:');",
									"console.log('- Payment ID:', response.paymentId);",
									"console.log('- Approval URL:', response.approvalUrl);",
									"console.log('');",
									"console.log('⚠️ IMPORTANT: Ouvrir cette URL dans le navigateur:');",
									"console.log(response.approvalUrl);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"orderId\": {{orderId}},\n  \"userId\": {{userId}},\n  \"amount\": {{orderTotal}},\n  \"currency\": \"USD\",\n  \"description\": \"Payment for Order #{{orderNumber}}\",\n  \"cancelUrl\": \"http://localhost:3000/payment/cancel\",\n  \"successUrl\": \"http://localhost:3000/payment/success\"\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/payments/paypal/create",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "paypal", "create"]
						},
						"description": "⭐ Étape 5: Créer le paiement PayPal\nRécupère l'URL d'approbation"
					}
				},
				{
					"name": "STEP 6: Execute PayPal Payment",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"paymentId\": \"{{paymentId}}\",\n  \"payerId\": \"REMPLACER_PAR_PAYER_ID_DE_PAYPAL\"\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/payments/paypal/execute",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "payments", "paypal", "execute"]
						},
						"description": "⭐ Étape 6: Exécuter le paiement\n⚠️ Nécessite que l'utilisateur ait approuvé sur PayPal\nRemplacer REMPLACER_PAR_PAYER_ID_DE_PAYPAL par le PayerID reçu"
					}
				},
				{
					"name": "STEP 7: Get User Orders (OpenFeign)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/{{userId}}/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "{{userId}}", "orders"]
						},
						"description": "⭐ Étape 7: Récupérer les commandes de l'utilisateur\nUser Service → Order Service (OpenFeign)"
					}
				}
			]
		},
		{
			"name": "7. DEMO OpenFeign - User → Order",
			"item": [
				{
					"name": "STEP 1: Create User for Demo",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const user = pm.response.json();",
									"pm.environment.set('demoUserId', user.id);",
									"console.log('Demo User ID:', user.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"feign.demo@example.com\",\n  \"firstName\": \"Feign\",\n  \"lastName\": \"Demo\",\n  \"password\": \"demo123\",\n  \"phoneNumber\": \"+33699999999\",\n  \"address\": \"456 Feign Street, Paris\",\n  \"role\": \"CLIENT\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/users",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users"]
						}
					}
				},
				{
					"name": "STEP 2: Create Orders for User",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userId\": {{demoUserId}},\n  \"adresseLivraison\": \"456 Feign Street, Paris\",\n  \"orderItems\": [\n    {\n      \"productId\": 1,\n      \"quantity\": 1\n    }\n  ]\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders"]
						}
					}
				},
				{
					"name": "STEP 3: Get User Orders via Feign",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/users/{{demoUserId}}/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "users", "{{demoUserId}}", "orders"]
						},
						"description": "⭐ OPENFEIGN DEMO:\nUser Service appelle Order Service\npour récupérer les commandes"
					}
				}
			]
		},
		{
			"name": "8. DEMO OpenFeign - Order → Product",
			"item": [
				{
					"name": "STEP 1: Check Product Stock Before",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const product = pm.response.json();",
									"pm.environment.set('demoStockBefore', product.stockQuantity);",
									"console.log('Stock avant:', product.stockQuantity);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "1"]
						}
					}
				},
				{
					"name": "STEP 2: Create Order (Stock Update via Feign)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userId\": 1,\n  \"adresseLivraison\": \"789 OpenFeign Avenue, Paris\",\n  \"orderItems\": [\n    {\n      \"productId\": 1,\n      \"quantity\": 10\n    }\n  ]\n}"
						},
						"url": {
							"raw": "http://localhost:8080/api/orders",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "orders"]
						},
						"description": "⭐ OPENFEIGN: Order Service → Product Service\nMet à jour automatiquement le stock"
					}
				},
				{
					"name": "STEP 3: Verify Stock After",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"const product = pm.response.json();",
									"const stockBefore = pm.environment.get('demoStockBefore');",
									"const difference = stockBefore - product.stockQuantity;",
									"console.log('Stock avant:', stockBefore);",
									"console.log('Stock après:', product.stockQuantity);",
									"console.log('Différence:', difference);",
									"",
									"pm.test('Stock decreased by 10', function() {",
									"    pm.expect(difference).to.equal(10);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8080/api/products/1",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8080",
							"path": ["api", "products", "1"]
						},
						"description": "Vérifier que le stock a diminué de 10"
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "userId",
			"value": ""
		},
		{
			"key": "productId",
			"value": ""
		},
		{
			"key": "orderId",
			"value": ""
		},
		{
			"key": "orderNumber",
			"value": ""
		},
		{
			"key": "orderTotal",
			"value": ""
		},
		{
			"key": "paymentId",
			"value": ""
		},
		{
			"key": "approvalUrl",
			"value": ""
		},
		{
			"key": "stockBefore",
			"value": ""
		},
		{
			"key": "demoUserId",
			"value": ""
		},
		{
			"key": "demoStockBefore",
			"value": ""
		}
	]
}

