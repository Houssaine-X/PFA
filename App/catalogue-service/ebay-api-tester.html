<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>eBay API Tester</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      h1 {
        color: #333;
      }
      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      input[type="text"] {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      input[type="number"] {
        width: 100px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      button {
        padding: 10px 20px;
        background-color: #0064d2;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      button:hover {
        background-color: #0053ba;
      }
      .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }
      .product-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        background: white;
        transition: transform 0.2s;
      }
      .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .product-image {
        width: 100%;
        height: 200px;
        object-fit: contain;
        border-radius: 4px;
        margin-bottom: 10px;
      }
      .product-title {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      .product-price {
        font-size: 18px;
        color: #0064d2;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .product-link {
        display: inline-block;
        padding: 8px 16px;
        background-color: #0064d2;
        color: white;
        text-decoration: none;
        border-radius: 4px;
        font-size: 12px;
      }
      .product-link:hover {
        background-color: #0053ba;
      }
      .error {
        color: red;
        padding: 10px;
        background-color: #ffebee;
        border-radius: 4px;
        margin-bottom: 20px;
      }
      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }
      .results-info {
        margin-bottom: 15px;
        color: #666;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üõçÔ∏è eBay Product Search</h1>

      <div class="search-box">
        <input
          type="text"
          id="searchQuery"
          placeholder="Search for products... (e.g., laptop, phone, camera)"
          value="laptop"
        />
        <input
          type="number"
          id="limitInput"
          placeholder="Limit"
          value="10"
          min="1"
          max="50"
        />
        <button onclick="searchProducts()">Search</button>
        <button onclick="getFeaturedProducts()">Get Featured</button>
      </div>

      <div id="error" class="error" style="display: none"></div>
      <div id="loading" class="loading" style="display: none">
        Loading products...
      </div>
      <div id="resultsInfo" class="results-info" style="display: none"></div>
    </div>

    <div id="products" class="product-grid"></div>

    <script>
      const API_BASE_URL = "http://localhost:8080/api/products/ebay";

      function showError(message) {
        const errorDiv = document.getElementById("error");
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
        setTimeout(() => {
          errorDiv.style.display = "none";
        }, 5000);
      }

      function showLoading(show) {
        document.getElementById("loading").style.display = show
          ? "block"
          : "none";
      }

      function displayProducts(data) {
        const productsDiv = document.getElementById("products");
        const resultsInfo = document.getElementById("resultsInfo");

        productsDiv.innerHTML = "";

        if (!data || !data.itemSummaries || data.itemSummaries.length === 0) {
          productsDiv.innerHTML =
            '<p style="text-align: center; color: #666;">No products found.</p>';
          resultsInfo.style.display = "none";
          return;
        }

        resultsInfo.textContent = `Found ${data.total} products, showing ${data.itemSummaries.length}`;
        resultsInfo.style.display = "block";

        data.itemSummaries.forEach((item) => {
          const productCard = document.createElement("div");
          productCard.className = "product-card";

          const imageUrl =
            item.image && item.image.length > 0
              ? item.image[0].imageUrl
              : "https://via.placeholder.com/200";
          const price = item.price
            ? `${item.price.value} ${item.price.currency}`
            : "Price not available";
          const title = item.title || "No title";
          const itemUrl = item.itemWebUrl || "#";

          productCard.innerHTML = `
                    <img src="${imageUrl}" alt="${title}" class="product-image" onerror="this.src='https://via.placeholder.com/200'">
                    <div class="product-title">${title}</div>
                    <div class="product-price">${price}</div>
                    <a href="${itemUrl}" target="_blank" class="product-link">View on eBay</a>
                `;

          productsDiv.appendChild(productCard);
        });
      }

      async function searchProducts() {
        const query = document.getElementById("searchQuery").value.trim();
        const limit = document.getElementById("limitInput").value;

        if (!query) {
          showError("Please enter a search query");
          return;
        }

        showLoading(true);

        try {
          const response = await fetch(
            `${API_BASE_URL}/search?q=${encodeURIComponent(
              query
            )}&limit=${limit}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          displayProducts(data);
        } catch (error) {
          console.error("Error fetching products:", error);
          showError("Error fetching products: " + error.message);
        } finally {
          showLoading(false);
        }
      }

      async function getFeaturedProducts() {
        showLoading(true);

        try {
          const response = await fetch(`${API_BASE_URL}/featured`);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          displayProducts(data);
        } catch (error) {
          console.error("Error fetching featured products:", error);
          showError("Error fetching featured products: " + error.message);
        } finally {
          showLoading(false);
        }
      }

      // Allow Enter key to trigger search
      document
        .getElementById("searchQuery")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            searchProducts();
          }
        });

      // Load featured products on page load
      window.addEventListener("load", getFeaturedProducts);
    </script>
  </body>
</html>
